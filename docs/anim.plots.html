<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />

<meta name="viewport" content="width=device-width, initial-scale=1">

<meta name="author" content="David Hugh-Jones" />

<meta name="date" content="2017-05-13" />

<title>Animations with anim.plots</title>



<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
</style>



<link rel="stylesheet" href="/Library/Frameworks/R.framework/Versions/3.3/Resources/library/rmarkdown/rmarkdown/templates/html_vignette/resources/vignette.css" type="text/css" />

</head>

<body>




<h1 class="title toc-ignore">Animations with anim.plots</h1>
<h4 class="author"><em>David Hugh-Jones</em></h4>
<h4 class="date"><em>2017-05-13</em></h4>



<link rel="stylesheet" href="http://vis.supstat.com/assets/themes/dinky/css/scianimator.css">
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"></script>
<script src="http://vis.supstat.com/assets/themes/dinky/js/jquery.scianimator.min.js"></script>
<div id="introduction" class="section level2">
<h2>Introduction</h2>
<p><a href="http://www.gapminder.org/videos/200-years-that-changed-the-world-bbc/">This presentation from GapMinder</a> shows the power of animated graphics. Animation can help tell a story through time, grabbing viewers’ attention. It can help us understand our data better, by engaging our natural sense of how events unfold in time. Many of our explanations use this: stories, narratives and history.</p>
<p>So far, though, animated graphics in R have been difficult. <code>anim.plots</code> aims to remedy this by providing simple commands to create animated plots, similar to standard R graphics. This vignette provides an introduction to <code>anim.plots</code>. By the end, you will be ready to create your own GapMinder-style animation.</p>
<p><code>anim.plots</code> is built on top of Yihui Xie’s <code>animation</code> package. <code>animation</code> works like traditional cartoon animation. It creates lots of static pictures, then flips through them quickly. Under the hood, <code>anim.plots</code> is doing the same thing, but it bundles it into simple one-liners. If there’s something you can’t do in <code>anim.plots</code>, I encourage you to look at <code>animation</code>.</p>
<p>This vignette will work best if you are online. If you’re not online, you can still read it, but you won’t be able to view the animations. It is also best viewed in your browser, and not e.g. from within RStudio.</p>
</div>
<div id="your-first-animation" class="section level2">
<h2>Your first animation</h2>
<p>Here’s a very simple animation using the <code>anim.plot</code> command. It shows a dot moving across the screen.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(anim.plots)
<span class="kw">anim.plot</span>(<span class="dv">1</span>:<span class="dv">10</span>, <span class="dv">1</span>:<span class="dv">10</span>, <span class="dt">times=</span><span class="dv">1</span>:<span class="dv">10</span>, <span class="dt">col=</span><span class="st">&quot;green&quot;</span>, <span class="dt">pch=</span><span class="dv">19</span>)</code></pre></div>
<div class="scianimator">
<div id="unnamed_chunk_2" style="display: inline-block;">

</div>
</div>
<script type="text/javascript">
  (function($) {
    $(document).ready(function() {
      var imgs = Array(10);
      for (i = 0; ; i++) {
        if (i == imgs.length) break;
        imgs[i] = "anim.plots_files/figure-html/unnamed-chunk-2-" + (i + 1) + ".png";
      }
      $("#unnamed_chunk_2").scianimator({
          "images": imgs,
          "delay": 1000,
          "controls": ["first", "previous", "play", "next", "last", "loop", "speed"],
      });
      $("#unnamed_chunk_2").scianimator("play");
    });
  })(jQuery);
</script>
<p>This command shows the basic way <code>anim.plots</code> commands work:</p>
<ul>
<li>The animated command (here, <code>anim.plot</code>) takes the same arguments as the normal graphics command (<code>plot</code>), plus an extra <code>times</code> argument.</li>
</ul>
<p>The <code>times</code> command controls what gets plotted when. Here, it runs from 1 to 10, so you see ten frames of animation.</p>
<p>In each frame, the corresponding values from the first two arguments to <code>anim.plot</code> get used. These also run from 1 to 10. They are passed in as the first two arguments to <code>plot</code>, which control the x and y position. So the green dot moves diagonally up the screen, from (1,1) to (10,10).</p>
<p>If we reverse the order of the <code>times</code> argument, we reverse the order of the plot:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">anim.plot</span>(<span class="dv">1</span>:<span class="dv">10</span>, <span class="dv">1</span>:<span class="dv">10</span>, <span class="dt">times=</span><span class="dv">10</span>:<span class="dv">1</span>, <span class="dt">col=</span><span class="st">&quot;green&quot;</span>, <span class="dt">pch=</span><span class="dv">19</span>)</code></pre></div>
<div class="scianimator">
<div id="unnamed_chunk_3" style="display: inline-block;">

</div>
</div>
<script type="text/javascript">
  (function($) {
    $(document).ready(function() {
      var imgs = Array(10);
      for (i = 0; ; i++) {
        if (i == imgs.length) break;
        imgs[i] = "anim.plots_files/figure-html/unnamed-chunk-3-" + (i + 1) + ".png";
      }
      $("#unnamed_chunk_3").scianimator({
          "images": imgs,
          "delay": 1000,
          "controls": ["first", "previous", "play", "next", "last", "loop", "speed"],
      });
      $("#unnamed_chunk_3").scianimator("play");
    });
  })(jQuery);
</script>
<p>If <code>times</code> has multiple non-unique values, then each set of points corresponding to a single value of <code>times</code> will be plotted together, in a single frame. So, this snippet plots our points two at a time:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">times &lt;-<span class="st"> </span><span class="kw">rep</span>(<span class="dv">1</span>:<span class="dv">5</span>, <span class="dt">each=</span><span class="dv">2</span>)
times</code></pre></div>
<pre><code>##  [1] 1 1 2 2 3 3 4 4 5 5</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">anim.plot</span>(<span class="dv">1</span>:<span class="dv">10</span>, <span class="dv">1</span>:<span class="dv">10</span>, <span class="dt">times=</span>times, <span class="dt">col=</span><span class="st">&quot;green&quot;</span>, <span class="dt">pch=</span><span class="dv">19</span>)</code></pre></div>
<div class="scianimator">
<div id="unnamed_chunk_4" style="display: inline-block;">

</div>
</div>
<script type="text/javascript">
  (function($) {
    $(document).ready(function() {
      var imgs = Array(5);
      for (i = 0; ; i++) {
        if (i == imgs.length) break;
        imgs[i] = "anim.plots_files/figure-html/unnamed-chunk-4-" + (i + 1) + ".png";
      }
      $("#unnamed_chunk_4").scianimator({
          "images": imgs,
          "delay": 1000,
          "controls": ["first", "previous", "play", "next", "last", "loop", "speed"],
      });
      $("#unnamed_chunk_4").scianimator("play");
    });
  })(jQuery);
</script>
<p>There are two shortcuts you can use. First, if <code>times</code> is a single number, <code>anim.plot</code> will create that many frames, each with an equal number of points. So the following code would have just the same result as the previous example:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">anim.plot</span>(<span class="dv">1</span>:<span class="dv">10</span>, <span class="dv">1</span>:<span class="dv">10</span>, <span class="dt">times=</span><span class="dv">5</span>, <span class="dt">col=</span><span class="st">&quot;green&quot;</span>, <span class="dt">pch=</span><span class="dv">19</span>)</code></pre></div>
<p>Second, if you don’t specify <code>times</code> at all, it will guess that you want to plot one point at a time. So</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">anim.plot</span>(<span class="dv">1</span>:<span class="dv">10</span>, <span class="dv">1</span>:<span class="dv">10</span>, <span class="dt">col=</span><span class="st">&quot;green&quot;</span>, <span class="dt">pch=</span><span class="dv">19</span>)</code></pre></div>
<p>will plot 10 frames.</p>
</div>
<div id="recycling-arguments" class="section level2">
<h2>Recycling arguments</h2>
<p>You can animate more than just the location of points. Here are the first twenty plot symbols, in different colours:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">cols &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;green&quot;</span>, <span class="st">&quot;blue&quot;</span>, <span class="st">&quot;red&quot;</span>, <span class="st">&quot;orange&quot;</span>, <span class="st">&quot;purple&quot;</span>)
y &lt;-<span class="st"> </span><span class="kw">rep</span>(<span class="dv">2</span>:<span class="dv">1</span>, <span class="dt">each=</span><span class="dv">10</span>)
<span class="kw">anim.plot</span>(<span class="dv">1</span>:<span class="dv">10</span>, y, <span class="dt">times=</span><span class="dv">1</span>:<span class="dv">20</span>, <span class="dt">col=</span>cols, <span class="dt">pch=</span><span class="dv">1</span>:<span class="dv">20</span>, <span class="dt">cex=</span><span class="dv">3</span>,
  <span class="dt">ylim=</span><span class="kw">c</span>(<span class="fl">0.5</span>,<span class="fl">2.5</span>))</code></pre></div>
<div class="scianimator">
<div id="unnamed_chunk_7" style="display: inline-block;">

</div>
</div>
<script type="text/javascript">
  (function($) {
    $(document).ready(function() {
      var imgs = Array(20);
      for (i = 0; ; i++) {
        if (i == imgs.length) break;
        imgs[i] = "anim.plots_files/figure-html/unnamed-chunk-7-" + (i + 1) + ".png";
      }
      $("#unnamed_chunk_7").scianimator({
          "images": imgs,
          "delay": 1000,
          "controls": ["first", "previous", "play", "next", "last", "loop", "speed"],
      });
      $("#unnamed_chunk_7").scianimator("play");
    });
  })(jQuery);
</script>
<p>The <code>pch</code> and <code>col</code> arguments control the plot symbol and colour, just as they do in the <code>plot</code> command. <code>pch</code> goes from 1 to 20, so a different plot symbol is shown in each frame. <code>cols</code> has five values, so it is recycled four times. (And <code>cex</code>, which controls the size of the plot symbol, has one value, so it is recycled twenty times! In fact, this was already happening in the earlier plots, with <code>pch=19</code> and <code>col='green'</code>.)</p>
<p>This example demonstrates <em>rule one</em> of recycling arguments in <code>anim.plots</code>:</p>
<ul>
<li>Per-point arguments are recycled to the total number of points plotted.</li>
</ul>
<p>“Per-point arguments” means arguments like <code>cex</code>, <code>pch</code> and <code>col</code> which can be different for different points.</p>
<p>This way of working should be familiar. In the <code>plot</code> command, you can plot different points with different colours by specifying a vector argument to <code>col</code>. Here, in the same way, you can plot points with different colours <em>across multiple frames of animation</em>.</p>
<p>You can also recycle <code>x</code> and <code>y</code> values. The example sets <code>x=1:10</code>, and this is used twice to produce two rows of plots.</p>
<p>Not all arguments work on each point. Some arguments work on a whole plot at once. But when you are animating, you can change those arguments too. The next command plots our symbols five at a time, and shows an appropriate title.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">titles &lt;-<span class="st"> </span><span class="kw">paste</span>(<span class="st">&quot;Symbols&quot;</span>, <span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">6</span>,<span class="dv">11</span>,<span class="dv">16</span>), <span class="st">&quot;to&quot;</span>, <span class="kw">c</span>(<span class="dv">5</span>,<span class="dv">10</span>,<span class="dv">15</span>,<span class="dv">20</span>))
<span class="kw">anim.plot</span>(<span class="kw">rep</span>(<span class="dv">1</span>:<span class="dv">10</span>,<span class="dv">2</span>), <span class="kw">rep</span>(<span class="dv">2</span>:<span class="dv">1</span>, <span class="dt">each=</span><span class="dv">10</span>), <span class="dt">times=</span><span class="dv">4</span>, <span class="dt">pch=</span><span class="dv">1</span>:<span class="dv">20</span>, <span class="dt">cex=</span><span class="dv">3</span>, <span class="dt">main=</span>titles, <span class="dt">ylim=</span><span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">3</span>))</code></pre></div>
<div class="scianimator">
<div id="unnamed_chunk_8" style="display: inline-block;">

</div>
</div>
<script type="text/javascript">
  (function($) {
    $(document).ready(function() {
      var imgs = Array(4);
      for (i = 0; ; i++) {
        if (i == imgs.length) break;
        imgs[i] = "anim.plots_files/figure-html/unnamed-chunk-8-" + (i + 1) + ".png";
      }
      $("#unnamed_chunk_8").scianimator({
          "images": imgs,
          "delay": 1000,
          "controls": ["first", "previous", "play", "next", "last", "loop", "speed"],
      });
      $("#unnamed_chunk_8").scianimator("play");
    });
  })(jQuery);
</script>
<p>There are four frames, and <code>titles</code> is a vector of length 4, one for each frame. <em>Rule two</em> of <code>anim.plots</code> is:</p>
<ul>
<li>Per-plot arguments are recycled to the total number of frames in the animation.</li>
</ul>
<p>Now you just need to know one more thing about argument recycling in <code>anim.plots</code>. To illustrate it, let’s suppose we want to animate “zooming in” on a distribution of points. To do that, we will change the <code>xlim</code> and <code>ylim</code> arguments to <code>plot</code>. These give the left/right, and top/bottom edges of the plot window. They are length two vectors.</p>
<p>You might think we would just pass in a vector of <code>xlim</code> values, twice the length of the number of frames, and chop it up with two <code>xlim</code> values for each frame. But in general this wouldn’t work very well - what if we want to pass in more complex arguments, like vectors with arbitrary lengths, or matrices?</p>
<p>Instead, we pass in a 2-by-n matrix of <code>xlim</code> values. This is sliced up, and one slice is used for each frame. Here’s the code:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"> x &lt;-<span class="st"> </span><span class="kw">rep</span>(<span class="kw">rnorm</span>(<span class="dv">4000</span>), <span class="dv">40</span>)
 y &lt;-<span class="st"> </span><span class="kw">rep</span>(<span class="kw">rnorm</span>(<span class="dv">4000</span>), <span class="dv">40</span>)
 lims &lt;-<span class="st"> </span><span class="dv">4</span>*<span class="fl">0.95</span>^(<span class="dv">1</span>:<span class="dv">40</span>)
 ylims &lt;-<span class="st"> </span>xlims &lt;-<span class="st"> </span><span class="kw">rbind</span>(lims, -lims) 
 <span class="co"># First five values of xlims: </span>
 xlims[,<span class="dv">1</span>:<span class="dv">5</span>]</code></pre></div>
<pre><code>##      [,1]  [,2]    [,3]      [,4]      [,5]
## lims  3.8  3.61  3.4295  3.258025  3.095124
##      -3.8 -3.61 -3.4295 -3.258025 -3.095124</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"> <span class="kw">anim.plot</span>(x, y, <span class="dt">times=</span><span class="dv">40</span>, <span class="dt">speed=</span><span class="dv">5</span>, <span class="dt">xlim=</span>xlims, <span class="dt">ylim=</span>ylims, 
       <span class="dt">col=</span><span class="kw">rgb</span>(<span class="kw">runif</span>(<span class="dv">4000</span>), <span class="dv">0</span>, <span class="kw">runif</span>(<span class="dv">4000</span>), .<span class="dv">3</span>), <span class="dt">pch=</span><span class="dv">19</span>)</code></pre></div>
<div class="scianimator">
<div id="unnamed_chunk_9" style="display: inline-block;">

</div>
</div>
<script type="text/javascript">
  (function($) {
    $(document).ready(function() {
      var imgs = Array(40);
      for (i = 0; ; i++) {
        if (i == imgs.length) break;
        imgs[i] = "anim.plots_files/figure-html/unnamed-chunk-9-" + (i + 1) + ".png";
      }
      $("#unnamed_chunk_9").scianimator({
          "images": imgs,
          "delay": 200,
          "controls": ["first", "previous", "play", "next", "last", "loop", "speed"],
      });
      $("#unnamed_chunk_9").scianimator("play");
    });
  })(jQuery);
</script>
<p>We repeat our x and y values 40 times, so we will plot the same points, but within different bounds. The plot zooms in by 5% each time.</p>
<p>So, <em>rule three</em> for recycling parameters is:</p>
<ul>
<li>Complex per-plot parameters are passed in as a matrix, which is sliced up to give one vector per frame.</li>
</ul>
<p>For more complex arguments, you can pass them in as a 3-or-more dimensional array. Later we’ll see an example in <code>anim.persp</code>.</p>
</div>
<div id="creating-incremental-plots" class="section level2">
<h2>Creating incremental plots</h2>
<p>Paradoxically, we don’t always want to plot “one time at a time”. Sometimes we may want to add points incrementally. There is a simple way to do this, using the <code>window</code> argument to <code>anim.plot</code>.</p>
<p>The default value of the <code>window</code> argument is <code>window=t</code>. This plots all the points from time t at time t. By using a different expression involving <code>t</code>, you can change the set of points that gets plotted. For example, <code>window=1:t</code> will plot everything from time 1 to time t. Let’s use this for a statistical demonstration of the effect of increasing sample size.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">allx &lt;-<span class="st"> </span><span class="kw">rnorm</span>(<span class="dv">400</span>)
ally &lt;-<span class="st"> </span>allx +<span class="st"> </span><span class="kw">rnorm</span>(<span class="dv">400</span>)
<span class="kw">anim.plot</span>(allx, ally, <span class="dt">times=</span><span class="dv">40</span>, <span class="dt">window=</span><span class="dv">1</span>:t, <span class="dt">col=</span><span class="kw">rgb</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="fl">0.5</span>), <span class="dt">pch=</span><span class="dv">19</span>, 
      <span class="dt">main=</span><span class="kw">paste</span>(<span class="st">&quot;Sample size&quot;</span>, <span class="dv">1</span>:<span class="dv">40</span>*<span class="dv">10</span>))</code></pre></div>
<div class="scianimator">
<div id="unnamed_chunk_10" style="display: inline-block;">

</div>
</div>
<script type="text/javascript">
  (function($) {
    $(document).ready(function() {
      var imgs = Array(40);
      for (i = 0; ; i++) {
        if (i == imgs.length) break;
        imgs[i] = "anim.plots_files/figure-html/unnamed-chunk-10-" + (i + 1) + ".png";
      }
      $("#unnamed_chunk_10").scianimator({
          "images": imgs,
          "delay": 1000,
          "controls": ["first", "previous", "play", "next", "last", "loop", "speed"],
      });
      $("#unnamed_chunk_10").scianimator("play");
    });
  })(jQuery);
</script>
<p>As <code>t</code> grows, the set of points plotted increases and the relationship between x and y becomes clearer.</p>
<p>You may be wondering why <code>window</code> doesn’t also affect the <code>main</code> argument and mess up your plot titles. The short answer is, magic ;-) The long answer is that <code>anim.plots</code> knows the difference between per-plot and per-point arguments: only per-point arguments are affected by <code>window</code>.</p>
<p>You don’t actually need <code>window</code> for this example: you could just use <code>anim.points</code> to add points incrementally to an animation. Our next trick uses <code>window</code> for something cleverer. We animate the number of discoveries made over the years 1860-1959, from the <code>discoveries</code> dataset.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">xlim &lt;-<span class="st"> </span><span class="kw">rbind</span>(<span class="dv">1840</span>:<span class="dv">1939</span>,<span class="dv">1860</span>:<span class="dv">1959</span>)
<span class="kw">anim.plot</span>(<span class="dv">1860</span>:<span class="dv">1959</span>, discoveries, <span class="dt">times=</span><span class="dv">100</span>, <span class="dt">xlim=</span>xlim, <span class="dt">col=</span><span class="st">&quot;red&quot;</span>, <span class="dt">xlab=</span><span class="st">&quot;Year&quot;</span>,
     <span class="dt">xaxp=</span><span class="kw">rbind</span>(xlim, <span class="dv">10</span>), <span class="dt">window=</span>(t<span class="dv">-20</span>):t, <span class="dt">type=</span><span class="st">&quot;b&quot;</span>, <span class="dt">lwd=</span><span class="dv">5</span>, <span class="dt">speed=</span><span class="dv">4</span>)</code></pre></div>
<div class="scianimator">
<div id="unnamed_chunk_11" style="display: inline-block;">

</div>
</div>
<script type="text/javascript">
  (function($) {
    $(document).ready(function() {
      var imgs = Array(100);
      for (i = 0; ; i++) {
        if (i == imgs.length) break;
        imgs[i] = "anim.plots_files/figure-html/unnamed-chunk-11-" + (i + 1) + ".png";
      }
      $("#unnamed_chunk_11").scianimator({
          "images": imgs,
          "delay": 1000,
          "controls": ["first", "previous", "play", "next", "last", "loop", "speed"],
      });
      $("#unnamed_chunk_11").scianimator("play");
    });
  })(jQuery);
</script>
<p>Here, we display discoveries in a 20-year window: <code>(t-20):t</code>.</p>
</div>
<div id="replaying-plots" class="section level2">
<h2>Replaying plots</h2>
<p><code>anim.plot</code> and similar functions return an object of class <code>anim.frames</code>. You can capture this and replay it in whole or part.</p>
<p>Let’s rerun our statistical demonstration. First, we use the <code>show=FALSE</code> argument to create an <code>anim.frames</code> object without displaying it.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">allx &lt;-<span class="st"> </span><span class="kw">rnorm</span>(<span class="dv">200</span>)
ally &lt;-<span class="st"> </span>allx +<span class="st"> </span><span class="kw">rnorm</span>(<span class="dv">200</span>, <span class="dv">0</span>, <span class="dv">2</span>)
stat.demo &lt;-<span class="st"> </span><span class="kw">anim.plot</span>(allx, ally, <span class="dt">times=</span><span class="dv">20</span>, <span class="dt">window=</span><span class="dv">1</span>:t, <span class="dt">col=</span><span class="kw">rgb</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="fl">0.5</span>), 
      <span class="dt">pch=</span><span class="dv">19</span>, <span class="dt">main=</span><span class="kw">paste</span>(<span class="st">&quot;Sample size&quot;</span>, <span class="dv">1</span>:<span class="dv">20</span>*<span class="dv">10</span>), <span class="dt">show=</span><span class="ot">FALSE</span>)</code></pre></div>
<p>Now we display the first five frames, and add a regression line:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">replay</span>(stat.demo, <span class="dt">frames=</span><span class="dv">1</span>:<span class="dv">5</span>)</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">abline</span>(<span class="kw">lm</span>(ally[<span class="dv">1</span>:<span class="dv">50</span>] ~<span class="st"> </span>allx[<span class="dv">1</span>:<span class="dv">50</span>]), <span class="dt">col=</span><span class="st">&quot;red&quot;</span>, <span class="dt">lwd=</span><span class="dv">2</span>)</code></pre></div>
<div class="scianimator">
<div id="unnamed_chunk_13" style="display: inline-block;">

</div>
</div>
<script type="text/javascript">
  (function($) {
    $(document).ready(function() {
      var imgs = Array(5);
      for (i = 0; ; i++) {
        if (i == imgs.length) break;
        imgs[i] = "anim.plots_files/figure-html/unnamed-chunk-13-" + (i + 1) + ".png";
      }
      $("#unnamed_chunk_13").scianimator({
          "images": imgs,
          "delay": 1000,
          "controls": ["first", "previous", "play", "next", "last", "loop", "speed"],
      });
      $("#unnamed_chunk_13").scianimator("play");
    });
  })(jQuery);
</script>
<p>Notice that you can add standard R graphics like <code>abline</code>. This is not surprising: really, everything in the animation is done by normal graphics functions.</p>
<p>Sometimes we need to call a separate function to change the plot. For example, to add a legend to a standard plot, you need to use the <code>legend</code> function. We can’t just do this at the end, because we want it to be shown during the whole animation.</p>
<p>To do this, you can use the <code>after</code> argument to <code>replay</code>. For example, the next animation shows the growth of fifty chicks who are fed one of four different diets. We add a legend showing the diets.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">ChickWeight$chn &lt;-<span class="st"> </span><span class="kw">as.numeric</span>(<span class="kw">as.factor</span>(ChickWeight$Chick))
chw.anim &lt;-<span class="st"> </span><span class="kw">anim.plot</span>(ChickWeight$chn, ChickWeight$weight, 
      <span class="dt">times=</span>ChickWeight$Time, <span class="dt">col=</span><span class="kw">as.numeric</span>(ChickWeight$Diet), 
      <span class="dt">pch=</span><span class="kw">as.numeric</span>(ChickWeight$Diet), <span class="dt">speed=</span><span class="dv">3</span>, <span class="dt">show=</span><span class="ot">FALSE</span>)

<span class="kw">replay</span>(chw.anim, <span class="dt">after=</span><span class="kw">legend</span>(<span class="st">&quot;topleft&quot;</span>, <span class="dt">legend=</span><span class="kw">paste</span>(<span class="st">&quot;Diet&quot;</span>, <span class="dv">1</span>:<span class="dv">4</span>), <span class="dt">pch=</span><span class="dv">1</span>:<span class="dv">4</span>, 
      <span class="dt">col=</span><span class="dv">1</span>:<span class="dv">4</span>))</code></pre></div>
<div class="scianimator">
<div id="unnamed_chunk_14" style="display: inline-block;">

</div>
</div>
<script type="text/javascript">
  (function($) {
    $(document).ready(function() {
      var imgs = Array(12);
      for (i = 0; ; i++) {
        if (i == imgs.length) break;
        imgs[i] = "anim.plots_files/figure-html/unnamed-chunk-14-" + (i + 1) + ".png";
      }
      $("#unnamed_chunk_14").scianimator({
          "images": imgs,
          "delay": 1000,
          "controls": ["first", "previous", "play", "next", "last", "loop", "speed"],
      });
      $("#unnamed_chunk_14").scianimator("play");
    });
  })(jQuery);
</script>
<p>The argument to <code>after</code> will be evaluated after each frame of the animation.</p>
<p>When <code>after</code> is evaluated, the arguments to the preceding function call are available in its environment. This lets you do things like data summaries. Here is our sample size demo again, but now we’ll add a regression line at each frame.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">replay</span>(stat.demo, <span class="dt">after=</span>{
        <span class="kw">abline</span>(<span class="kw">lm</span>(ally~allx), <span class="dt">col=</span><span class="st">&quot;red&quot;</span>)
        <span class="kw">abline</span>(<span class="kw">lm</span>(y~x), <span class="dt">pty=</span><span class="dv">1</span>, <span class="dt">lty=</span><span class="dv">2</span>, <span class="dt">col=</span><span class="st">&quot;grey2&quot;</span>) 
        <span class="kw">legend</span>(<span class="st">&quot;topleft&quot;</span>, <span class="dt">lty=</span><span class="dv">2</span>:<span class="dv">1</span>, <span class="dt">col=</span><span class="kw">c</span>(<span class="st">&quot;grey2&quot;</span>, <span class="st">&quot;red&quot;</span>), <span class="dt">legend=</span><span class="kw">c</span>(<span class="st">&quot;Estimate&quot;</span>, 
              <span class="st">&quot;True&quot;</span>))
      })</code></pre></div>
<div class="scianimator">
<div id="unnamed_chunk_15" style="display: inline-block;">

</div>
</div>
<script type="text/javascript">
  (function($) {
    $(document).ready(function() {
      var imgs = Array(20);
      for (i = 0; ; i++) {
        if (i == imgs.length) break;
        imgs[i] = "anim.plots_files/figure-html/unnamed-chunk-15-" + (i + 1) + ".png";
      }
      $("#unnamed_chunk_15").scianimator({
          "images": imgs,
          "delay": 1000,
          "controls": ["first", "previous", "play", "next", "last", "loop", "speed"],
      });
      $("#unnamed_chunk_15").scianimator("play");
    });
  })(jQuery);
</script>
<p>Look at the first two calls to <code>abline</code>. The first call uses <code>allx</code> and <code>ally</code>, data from the global environment. The second call uses <code>x</code> and <code>y</code>. These are the names of the first two arguments to <code>plot</code> - the data that has been plotted. Notice also how we use curly brackets (<code>{}</code>) to run multiple statements after each plot.</p>
<p>There is also a <code>before</code> argument to call a function before the main plot is run. For more complicated plots, you can <code>merge</code> two <code>anim.frames</code> objects: more on this below.</p>
</div>
<div id="other-functions-and-formula-interface" class="section level2">
<h2>Other functions and formula interface</h2>
<p>Like many plot functions, <code>anim.plot</code> has a formula interface. The following command would show the plot of chick growth again, and is much easier to type.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">anim.plot</span>(weight ~<span class="st"> </span>chn +<span class="st"> </span>Time, <span class="dt">data=</span>ChickWeight, <span class="dt">col=</span><span class="kw">as.numeric</span>(Diet), 
     <span class="dt">pch=</span><span class="kw">as.numeric</span>(Diet), <span class="dt">speed=</span><span class="dv">3</span>)</code></pre></div>
<p>The format is <code>y ~ x + times</code>. As you can see, other arguments also get evaluated in the environment provided by <code>data</code>.</p>
<p>As well as the standard plot function, <code>anim.plots</code> provides animated versions of several others. <code>anim.hist</code> is a histogram:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">anim.hist</span>(<span class="kw">rep</span>(<span class="kw">rnorm</span>(<span class="dv">5000</span>), <span class="dv">7</span>), <span class="dt">times=</span><span class="kw">rep</span>(<span class="dv">1</span>:<span class="dv">7</span>, <span class="dt">each=</span><span class="dv">5000</span>), 
     <span class="dt">breaks=</span><span class="kw">c</span>(<span class="dv">5</span>,<span class="dv">10</span>,<span class="dv">20</span>,<span class="dv">50</span>,<span class="dv">100</span>,<span class="dv">200</span>, <span class="dv">500</span>, <span class="dv">1000</span>))</code></pre></div>
<div class="scianimator">
<div id="unnamed_chunk_17" style="display: inline-block;">

</div>
</div>
<script type="text/javascript">
  (function($) {
    $(document).ready(function() {
      var imgs = Array(7);
      for (i = 0; ; i++) {
        if (i == imgs.length) break;
        imgs[i] = "anim.plots_files/figure-html/unnamed-chunk-17-" + (i + 1) + ".png";
      }
      $("#unnamed_chunk_17").scianimator({
          "images": imgs,
          "delay": 1000,
          "controls": ["first", "previous", "play", "next", "last", "loop", "speed"],
      });
      $("#unnamed_chunk_17").scianimator("play");
    });
  })(jQuery);
</script>
<p><code>anim.curve</code> plots a mathematical curve. The value <code>t</code> changes over time.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">anim.curve</span>(<span class="kw">sin</span>(x*t), <span class="dt">times=</span><span class="dv">1</span>:<span class="dv">30</span>, <span class="dt">n=</span><span class="dv">100</span>, <span class="dt">speed=</span><span class="dv">12</span>, <span class="dt">col=</span><span class="st">&quot;darkgreen&quot;</span>, <span class="dt">from=</span>-<span class="dv">1</span>, <span class="dt">to=</span><span class="dv">1</span>)</code></pre></div>
<div class="scianimator">
<div id="unnamed_chunk_18" style="display: inline-block;">

</div>
</div>
<script type="text/javascript">
  (function($) {
    $(document).ready(function() {
      var imgs = Array(30);
      for (i = 0; ; i++) {
        if (i == imgs.length) break;
        imgs[i] = "anim.plots_files/figure-html/unnamed-chunk-18-" + (i + 1) + ".png";
      }
      $("#unnamed_chunk_18").scianimator({
          "images": imgs,
          "delay": 250,
          "controls": ["first", "previous", "play", "next", "last", "loop", "speed"],
      });
      $("#unnamed_chunk_18").scianimator("play");
    });
  })(jQuery);
</script>
<p><code>anim.contour</code> does contour plots. Here’s the map of the Maunga Whau volcano in Auckland, emerging from a sphere. (Well, I had to come up with something.)</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># create a sphere:</span>
tmp &lt;-<span class="st"> </span>volcano
tmp[] &lt;-<span class="st"> </span><span class="dv">200</span> -<span class="st"> </span>((<span class="kw">row</span>(tmp) -<span class="st"> </span><span class="dv">43</span>)^<span class="dv">2</span> +<span class="st"> </span>(<span class="kw">col</span>(tmp) -<span class="st"> </span><span class="dv">30</span>)^<span class="dv">2</span>)/<span class="dv">20</span>
<span class="co"># an animated contour needs a 3D array:</span>
cplot &lt;-<span class="st"> </span><span class="kw">array</span>(<span class="ot">NA</span>, <span class="dt">dim=</span><span class="kw">c</span>(<span class="dv">87</span>,<span class="dv">61</span>,<span class="dv">20</span>))
cplot[,,<span class="dv">1</span>] &lt;-<span class="st"> </span>tmp
cplot[,,<span class="dv">20</span>] &lt;-<span class="st"> </span>volcano
<span class="co"># morph the volcano into a circle:</span>
cplot &lt;-<span class="st"> </span><span class="kw">apply</span>(cplot, <span class="dv">1</span>:<span class="dv">2</span>, function(x) <span class="kw">seq</span>(x[<span class="dv">1</span>], x[<span class="dv">20</span>], <span class="dt">length.out=</span><span class="dv">20</span>))
cplot &lt;-<span class="st"> </span><span class="kw">aperm</span>(cplot, <span class="kw">c</span>(<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">1</span>))
<span class="kw">dim</span>(cplot) <span class="co"># the third dimension is time</span></code></pre></div>
<pre><code>## [1] 87 61 20</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">anim.contour</span>(<span class="dt">z=</span>cplot, <span class="dt">times=</span><span class="dv">1</span>:<span class="dv">20</span>, <span class="dt">speed=</span><span class="dv">3</span>, <span class="dt">levels=</span><span class="dv">80</span> +<span class="st"> </span><span class="dv">1</span>:<span class="dv">12</span>*<span class="dv">10</span>, <span class="dt">lty=</span><span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">2</span>))</code></pre></div>
<div class="scianimator">
<div id="unnamed_chunk_19" style="display: inline-block;">

</div>
</div>
<script type="text/javascript">
  (function($) {
    $(document).ready(function() {
      var imgs = Array(20);
      for (i = 0; ; i++) {
        if (i == imgs.length) break;
        imgs[i] = "anim.plots_files/figure-html/unnamed-chunk-19-" + (i + 1) + ".png";
      }
      $("#unnamed_chunk_19").scianimator({
          "images": imgs,
          "delay": 1000,
          "controls": ["first", "previous", "play", "next", "last", "loop", "speed"],
      });
      $("#unnamed_chunk_19").scianimator("play");
    });
  })(jQuery);
</script>
<p>The closely related <code>anim.persp</code> does animated 3D plots.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">par</span>(<span class="dt">mar=</span><span class="kw">rep</span>(.<span class="dv">4</span>,<span class="dv">4</span>))
cplot2 &lt;-<span class="st"> </span><span class="kw">apply</span>(cplot, <span class="dv">1</span>:<span class="dv">2</span>, function(x) <span class="kw">seq</span>(<span class="dv">94</span>, x[<span class="dv">20</span>], <span class="dt">length.out=</span><span class="dv">20</span>))
cplot2 &lt;-<span class="st"> </span><span class="kw">aperm</span>(cplot2, <span class="kw">c</span>(<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">1</span>)) 

<span class="kw">anim.persp</span>(<span class="dt">z=</span>cplot2, <span class="dt">times=</span><span class="dv">1</span>:<span class="dv">20</span>, <span class="dt">phi=</span><span class="dv">15</span>:<span class="dv">34</span>, <span class="dt">theta=</span><span class="dv">30</span>:<span class="dv">49</span>, <span class="dt">speed=</span><span class="dv">5</span>, <span class="dt">border=</span><span class="ot">NA</span>, 
        <span class="dt">col=</span><span class="st">&quot;yellowgreen&quot;</span>, <span class="dt">shade=</span>.<span class="dv">5</span>, <span class="dt">box=</span><span class="ot">FALSE</span>)</code></pre></div>
<div class="scianimator">
<div id="unnamed_chunk_20" style="display: inline-block;">

</div>
</div>
<script type="text/javascript">
  (function($) {
    $(document).ready(function() {
      var imgs = Array(20);
      for (i = 0; ; i++) {
        if (i == imgs.length) break;
        imgs[i] = "anim.plots_files/figure-html/unnamed-chunk-20-" + (i + 1) + ".png";
      }
      $("#unnamed_chunk_20").scianimator({
          "images": imgs,
          "delay": 1000,
          "controls": ["first", "previous", "play", "next", "last", "loop", "speed"],
      });
      $("#unnamed_chunk_20").scianimator("play");
    });
  })(jQuery);
</script>
<p>Both of these provide a 3D array as their first argument. This 3D array is sliced up, and each slice is passed to <code>contour</code> or <code>persp</code> to create a separate frame.</p>
<p><code>anim.barplot</code> is a little tricky. You can pass it a vector, which will be cut up according to <code>times</code> to create a single-D barplot. Or you can pass it a 3D matrix which will be sliced up to create a multiple barplot (either stacked or side-by-side). The example shows 20 rounds of a laboratory public goods game, dividing subjects up by the amount they contributed and showing whether or not their fellow group members punished them.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">prop &lt;-<span class="st"> </span><span class="kw">prop.table</span>(PGgame, <span class="dv">2</span>:<span class="dv">3</span>)
prop[, , <span class="dv">1</span>:<span class="dv">2</span>]</code></pre></div>
<pre><code>## , , Period = 1
## 
##        Contribution
## Picked  Non-unique lowest Not lowest/all same Unique lowest
##   FALSE         1.0000000           1.0000000     0.5909091
##   TRUE          0.0000000           0.0000000     0.4090909
## 
## , , Period = 2
## 
##        Contribution
## Picked  Non-unique lowest Not lowest/all same Unique lowest
##   FALSE         0.9047619           1.0000000     0.7391304
##   TRUE          0.0952381           0.0000000     0.2608696</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">anim.barplot</span>(prop, <span class="dt">main=</span><span class="kw">paste</span>(<span class="st">&quot;Period&quot;</span>, <span class="dv">1</span>:<span class="dv">20</span>), <span class="dt">legend=</span><span class="ot">TRUE</span>, <span class="dt">ylim=</span><span class="kw">c</span>(<span class="dv">0</span>, <span class="fl">1.5</span>),
      <span class="dt">col=</span><span class="kw">c</span>(<span class="st">&quot;grey&quot;</span>, <span class="st">&quot;red&quot;</span>),
      <span class="dt">args.legend=</span><span class="kw">list</span>(<span class="dt">x=</span><span class="st">&quot;topright&quot;</span>, <span class="dt">legend=</span><span class="kw">c</span>(<span class="st">&quot;Punished&quot;</span>, <span class="st">&quot;Not punished&quot;</span>), 
      <span class="dt">bty=</span><span class="st">&quot;n&quot;</span>, <span class="dt">horiz=</span><span class="ot">TRUE</span>))</code></pre></div>
<div class="scianimator">
<div id="unnamed_chunk_21" style="display: inline-block;">

</div>
</div>
<script type="text/javascript">
  (function($) {
    $(document).ready(function() {
      var imgs = Array(20);
      for (i = 0; ; i++) {
        if (i == imgs.length) break;
        imgs[i] = "anim.plots_files/figure-html/unnamed-chunk-21-" + (i + 1) + ".png";
      }
      $("#unnamed_chunk_21").scianimator({
          "images": imgs,
          "delay": 1000,
          "controls": ["first", "previous", "play", "next", "last", "loop", "speed"],
      });
      $("#unnamed_chunk_21").scianimator("play");
    });
  })(jQuery);
</script>
<p>Lastly, most of the usual <code>points</code>-style functions have animated versions. In particular there are <code>anim.points</code>, <code>anim.lines</code>, <code>anim.text</code> and <code>anim.symbols</code>. All these will add to an existing plot, rather than create a new one.</p>
<p>Here, we use <code>anim.lines</code> to recreate an animated version of a famous plot. (You will need the <code>maps</code> library installed to see it.)</p>
<p><strong>Note</strong>: as of November 2014, this and the subsequent plot don’t show in <code>knitr</code>. They work if run from the command line, however.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"> if (<span class="kw">require</span>(<span class="st">&#39;maps&#39;</span>)) {
   <span class="kw">map</span>(<span class="st">&#39;world&#39;</span>, <span class="dt">xlim=</span><span class="kw">c</span>(<span class="dv">22</span>, <span class="dv">40</span>), <span class="dt">ylim=</span><span class="kw">c</span>(<span class="dv">52</span>,<span class="dv">58</span>), <span class="dt">fill=</span><span class="ot">TRUE</span>, <span class="dt">col=</span><span class="kw">c</span>(<span class="st">&quot;wheat&quot;</span>, <span class="st">&quot;sienna1&quot;</span>))
   if (<span class="kw">require</span>(<span class="st">&#39;mapdata&#39;</span>)) <span class="kw">map</span>(<span class="st">&#39;rivers&#39;</span>, <span class="dt">add=</span><span class="ot">TRUE</span>)
   <span class="kw">title</span>(<span class="st">&quot;March of the Grande Armee on Moscow&quot;</span>)
   <span class="kw">points</span>(cities$long, cities$lat, <span class="dt">pch=</span><span class="dv">18</span>)
   <span class="kw">text</span>(cities$long, cities$lat, <span class="dt">labels=</span>cities$city, <span class="dt">pos=</span><span class="dv">4</span>, <span class="dt">cex=</span>.<span class="dv">7</span>)
   <span class="kw">with</span>(troops[troops$group==<span class="dv">1</span>,], <span class="kw">anim.lines</span>(<span class="dt">x=</span>long,
         <span class="dt">y=</span>lat, <span class="dt">window=</span>t:(t<span class="dv">+1</span>), <span class="dt">speed=</span><span class="dv">2</span>, <span class="dt">lwd=</span>survivors/<span class="dv">10000</span>,
        <span class="dt">col=</span><span class="kw">rgb</span>(.<span class="dv">3</span>,.<span class="dv">16</span>,.<span class="dv">16</span>)))
}</code></pre></div>
<pre><code>## Loading required package: maps</code></pre>
<pre><code>## Loading required package: mapdata</code></pre>
<div class="scianimator">
<div id="unnamed_chunk_22" style="display: inline-block;">

</div>
</div>
<script type="text/javascript">
  (function($) {
    $(document).ready(function() {
      var imgs = Array(1);
      for (i = 0; ; i++) {
        if (i == imgs.length) break;
        imgs[i] = "anim.plots_files/figure-html/unnamed-chunk-22-" + (i + 1) + ".png";
      }
      $("#unnamed_chunk_22").scianimator({
          "images": imgs,
          "delay": 1000,
          "controls": ["first", "previous", "play", "next", "last", "loop", "speed"],
      });
      $("#unnamed_chunk_22").scianimator("play");
    });
  })(jQuery);
</script>
<p>There are also <code>anim.segments</code> and <code>anim.arrows</code>. Like <code>anim.points</code> and friends, these functions add to the plot between frames, rather than redrawing it. The convenience functions <code>anim.arrowplot</code> and <code>anim.segmentplot</code> redraw the plot before they are called.</p>
<p>Below we draw the paths of all 2009 hurricanes, starting them all simultaneously at their first recorded time.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">if (<span class="kw">require</span>(<span class="st">&#39;maps&#39;</span>)) {
  hr &lt;-<span class="st"> </span><span class="kw">subset</span>(hurricanes, lat &gt;<span class="st"> </span><span class="dv">0</span> &amp;<span class="st"> </span>lat &lt;<span class="st"> </span><span class="dv">50</span> &amp;<span class="st"> </span>lon &gt;<span class="st"> </span>-<span class="dv">95</span> &amp;<span class="st"> </span>lon &lt;<span class="st"> </span>-<span class="dv">20</span> &amp;
<span class="st">        </span>Shour %%<span class="st"> </span><span class="dv">6</span> ==<span class="st"> </span><span class="dv">0</span>)
  hr$dlat &lt;-<span class="st"> </span><span class="kw">cos</span>(hr$diruv/<span class="dv">360</span>*<span class="dv">2</span>*pi) *<span class="st"> </span>hr$maguv /<span class="st"> </span><span class="dv">8</span>
  hr$dlon &lt;-<span class="st"> </span><span class="kw">sin</span>(hr$diruv/<span class="dv">360</span>*<span class="dv">2</span>*pi) *<span class="st"> </span>hr$maguv /<span class="st"> </span><span class="dv">8</span>
  hr$name &lt;-<span class="st"> </span><span class="kw">sub</span>(<span class="st">&quot;</span><span class="ch">\\</span><span class="st">s+$&quot;</span>, <span class="st">&quot;&quot;</span>, hr$name)
  <span class="kw">map</span>(<span class="st">&#39;world&#39;</span>, <span class="dt">xlim=</span><span class="kw">c</span>(-<span class="dv">95</span>,-<span class="dv">20</span>), <span class="dt">ylim=</span><span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">50</span>), <span class="dt">fill=</span><span class="ot">TRUE</span>, <span class="dt">col=</span><span class="kw">terrain.colors</span>(<span class="dv">10</span>))
  <span class="kw">title</span>(<span class="st">&quot;Hurricanes, 2009&quot;</span>)
  <span class="kw">with</span>(hr[!<span class="kw">duplicated</span>(hr$name),], <span class="kw">text</span>(lon, lat, <span class="dt">labels=</span><span class="kw">paste0</span>(name, <span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span>, Yr), <span class="dt">cex=</span><span class="fl">0.8</span>))
  <span class="kw">with</span>(hr, <span class="kw">anim.arrows</span>(<span class="dt">x0=</span>lon, <span class="dt">y0=</span>lat, <span class="dt">y1=</span>lat+dlat, <span class="dt">x1=</span>lon+dlon, <span class="dt">times=</span>Shour, 
        <span class="dt">speed=</span><span class="dv">12</span>, <span class="dt">col=</span><span class="kw">rgb</span>(<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">1</span>,<span class="fl">0.8</span>), <span class="dt">length=</span>.<span class="dv">1</span>, <span class="dt">lwd=</span><span class="dv">2</span>))
}</code></pre></div>
<div class="scianimator">
<div id="unnamed_chunk_23" style="display: inline-block;">

</div>
</div>
<script type="text/javascript">
  (function($) {
    $(document).ready(function() {
      var imgs = Array(1);
      for (i = 0; ; i++) {
        if (i == imgs.length) break;
        imgs[i] = "anim.plots_files/figure-html/unnamed-chunk-23-" + (i + 1) + ".png";
      }
      $("#unnamed_chunk_23").scianimator({
          "images": imgs,
          "delay": 1000,
          "controls": ["first", "previous", "play", "next", "last", "loop", "speed"],
      });
      $("#unnamed_chunk_23").scianimator("play");
    });
  })(jQuery);
</script>
<p>Now we’ve got almost all the tools we need to create our own Gapminder-style animation. The last tool is the <code>merge</code> method for two <code>anim.frames</code> objects. This creates a single animation from two objects. We use it below to add labels to the larger countries.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">pl &lt;-<span class="st"> </span><span class="kw">palette</span>(<span class="kw">adjustcolor</span>(<span class="kw">rainbow</span>(<span class="dv">23</span>), <span class="dv">1</span>, .<span class="dv">6</span>, .<span class="dv">6</span>, .<span class="dv">6</span>, <span class="dt">offset=</span><span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,-<span class="fl">0.1</span>)))

blobs &lt;-<span class="st"> </span><span class="kw">anim.plot</span>(lifex ~<span class="st"> </span>GDP +<span class="st"> </span>year, <span class="dt">data=</span>gm_data, <span class="dt">log=</span><span class="st">&quot;x&quot;</span>,
      <span class="dt">cex=</span><span class="kw">sqrt</span>(pop)*<span class="fl">0.0004</span>, <span class="dt">pch=</span><span class="dv">19</span>, <span class="dt">col=</span>region, <span class="dt">xlab=</span><span class="st">&quot;GDP&quot;</span>, 
      <span class="dt">ylab=</span><span class="st">&quot;Life expectancy&quot;</span>, <span class="dt">speed=</span><span class="dv">7</span>, <span class="dt">subset=</span>year &gt;<span class="st"> </span><span class="dv">1850</span>, <span class="dt">show=</span><span class="ot">FALSE</span>)
cnames &lt;-<span class="st"> </span><span class="kw">anim.text</span>(lifex ~<span class="st"> </span>GDP +<span class="st"> </span>year, <span class="dt">data=</span>gm_data,
      <span class="dt">labels=</span>country, <span class="dt">speed=</span><span class="dv">7</span>, <span class="dt">subset=</span>year &gt;<span class="st"> </span><span class="dv">1850</span> &amp;<span class="st"> </span>pop &gt;<span class="st"> </span><span class="dv">50000000</span>, 
      <span class="dt">show=</span><span class="ot">FALSE</span>, <span class="dt">cex=</span><span class="fl">0.7</span>, <span class="dt">col=</span><span class="st">&quot;darkorange&quot;</span>)
<span class="kw">replay</span>(<span class="kw">merge</span>(blobs, cnames))</code></pre></div>
<div class="scianimator">
<div id="unnamed_chunk_24" style="display: inline-block;">

</div>
</div>
<script type="text/javascript">
  (function($) {
    $(document).ready(function() {
      var imgs = Array(162);
      for (i = 0; ; i++) {
        if (i == imgs.length) break;
        imgs[i] = "anim.plots_files/figure-html/unnamed-chunk-24-" + (i + 1) + ".png";
      }
      $("#unnamed_chunk_24").scianimator({
          "images": imgs,
          "delay": 200,
          "controls": ["first", "previous", "play", "next", "last", "loop", "speed"],
      });
      $("#unnamed_chunk_24").scianimator("play");
    });
  })(jQuery);
</script>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">palette</span>(pl)</code></pre></div>
<p>Merging is quite primitive - it simply interleaves graphics calls. Don’t expect it to put different plots on the same window unless one of the calls is to a function like <code>points</code>.</p>
</div>
<div id="tips-and-tricks" class="section level2">
<h2>Tips and tricks</h2>
<p>To replay plots faster or slower, use the <code>speed</code> argument. <code>knitr</code> doesn’t display this nicely in this document, but it will work for you.</p>
<p>Similarly, if you have different intervals between your values of <code>times</code>, <code>anim.plots</code> will respect these when they are played. For example</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">anim.plot</span>(<span class="dv">1</span>:<span class="dv">5</span>, <span class="dv">1</span>:<span class="dv">5</span>, <span class="dt">times=</span><span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">8</span>,<span class="dv">9</span>,<span class="dv">10</span>))</code></pre></div>
<p>will show a long pause between the second and third frames. To turn this feature off, pass the argument <code>use.times=FALSE</code>.</p>
<p>You can process arguments for each individual plot using the <code>window.process</code> argument. This should be a function which takes two arguments - a list of arguments to plot, and a vector of <code>times</code>. It should return the plot arguments, suitably processed. This can be useful for, e.g., drawing animated movement:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">anim.plot</span>(<span class="dv">1</span>:<span class="dv">100</span>, <span class="dv">1</span>:<span class="dv">100</span> +<span class="st"> </span><span class="kw">sin</span>(<span class="dv">1</span>:<span class="dv">100</span>/<span class="dv">3</span>)*<span class="dv">5</span>, <span class="dt">speed=</span><span class="dv">10</span>, <span class="dt">window=</span>(t<span class="dv">-5</span>):t, 
      <span class="dt">window.process =</span> function(args, times){
        args$col &lt;-<span class="st"> </span><span class="kw">rgb</span>(<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>:<span class="dv">5</span>/<span class="dv">5</span>) <span class="co"># fade shadows</span>
        <span class="kw">return</span>(args)
      })</code></pre></div>
<div class="scianimator">
<div id="unnamed_chunk_26" style="display: inline-block;">

</div>
</div>
<script type="text/javascript">
  (function($) {
    $(document).ready(function() {
      var imgs = Array(100);
      for (i = 0; ; i++) {
        if (i == imgs.length) break;
        imgs[i] = "anim.plots_files/figure-html/unnamed-chunk-26-" + (i + 1) + ".png";
      }
      $("#unnamed_chunk_26").scianimator({
          "images": imgs,
          "delay": 100,
          "controls": ["first", "previous", "play", "next", "last", "loop", "speed"],
      });
      $("#unnamed_chunk_26").scianimator("play");
    });
  })(jQuery);
</script>
<p>Lastly, if you’re feeling adventurous, you can pass a different function than <code>plot</code> into <code>anim.plot</code> using the <code>fn</code> argument. (Quite a few of the built-in functions work this way.) You may even be able to use <code>ggplot</code> or similar….</p>
</div>
<div id="saving-your-plots" class="section level2">
<h2>Saving your plots</h2>
<p>The function <code>anim.save()</code> will save your <code>anim.frames</code> objects. It simply calls the underlying functions from the <code>animation</code> package.</p>
<p>These functions do not respect changes in animation speed. For example, the following code would show a rocket boosting off:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">tmp &lt;-<span class="st"> </span><span class="kw">anim.plot</span>(<span class="dv">1</span>, <span class="dv">1</span>:<span class="dv">30</span>, <span class="dt">times=</span><span class="kw">sqrt</span>(<span class="dv">1</span>:<span class="dv">30</span>))</code></pre></div>
<p>But when you save it, it will go at constant speed. To get round this, run e.g.:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">anim.save</span>(<span class="kw">anim.smooth</span>(tmp, <span class="dt">fps=</span><span class="dv">10</span>), <span class="dt">type=</span><span class="st">&quot;Video&quot;</span>, <span class="dt">filename=</span><span class="st">&quot;rocket.mp4&quot;</span>)</code></pre></div>
<p>The <code>anim.smooth</code> function creates a “smoothed” version of the animation, which plays each frame after a constant interval. This involves creating many more frames, so when you play it in R, it will probably look slower. However, when you save it, it should look right.</p>
</div>
<div id="getting-help-and-contributing" class="section level2">
<h2>Getting help and contributing</h2>
<p>The code lives at <a href="http://github.com/hughjonesd/anim.plots" class="uri">http://github.com/hughjonesd/anim.plots</a>, and issues can be reported at <a href="http://github.com/hughjonesd/anim.plots/issues" class="uri">http://github.com/hughjonesd/anim.plots/issues</a>. Enjoy!</p>
</div>



<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
